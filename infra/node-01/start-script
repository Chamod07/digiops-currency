# Copyright (c) 2025, WSO2 LLC. (https://www.wso2.com). All Rights Reserved.

# This software is the property of WSO2 LLC. and its suppliers, if any.
# Dissemination of any information or reproduction of any material contained
# herein in any form is strictly forbidden, unless permitted by WSO2 expressly.
# You may not alter or remove any copyright or other notice from copies of this content.

#!/bin/bash

# Extract the account address from keystore key file
ACCOUNT=$(grep -o '"address":"[^"]*"' /data-directory/keystore/key | cut -d'"' -f4)
ACCOUNT="0x${ACCOUNT}"

# Initialize the node if it hasn't been initialized yet
geth --datadir /data-directory init /startup-scripts/genesis.json

# Start the node
exec geth --datadir /data-directory \
  --ipcpath "/startup-scripts/geth.ipc" \
  --networkid 10000 \
  --nodiscover \
  --mine \
  --miner.etherbase "${ACCOUNT}" \
  --unlock "${ACCOUNT}" \
  --password /startup-scripts/password.txt \
  --http.vhosts=* \
  --http \
  --http.addr "0.0.0.0" \
  --http.port "8545" \
  --http.corsdomain "*" \
  --http.api "admin,eth,web3,personal,net,miner,clique" \
  --allow-insecure-unlock \
  --authrpc.port "8552" \
  --port "30303" \
  --syncmode "full"
